### ì„¹ì…˜ ì„¤ëª…

âœ” êµ¬í˜„ìˆœì„œ (8ê°•)

`ì†ŒìŠ¤ ì½”ë“œ ì‘ì„± -> Dockerfile ì‘ì„± -> docker-compose ì‘ì„±`

-   ì†ŒìŠ¤ ì½”ë“œ ì‘ì„±

    -   NodeJs -> React

-   Dockerfile ì‘ì„±

    -   ê°œë°œí™˜ê²½
        
        - Front -> Server -> mysql -> nginx

    -   ìš´ì˜í™˜ê²½

        -   Front -> Server -> Mysql -> Nginx

-   docker-compose ì‘ì„±

    ``` js
    version

    services

        frontend

        backend

        nginx

        mysql
    ```

âœ” êµ¬í˜„ìˆœì„œ (9ê°•)

` ê¹ƒí—™ì— Push -> Travis CI -> Docker Hub -> AWS ElasticBeanStalk
`

-   ê¹ƒí—™ì— Push

    -   Feature branch -> Master branch

-    Travis CI


        -   í…ŒìŠ¤íŠ¸ ì†ŒìŠ¤ ì‹¤í–‰ -> í…ŒìŠ¤íŠ¸ ì„±ê³µ -> ê°ê°ì˜ Dockerfileì„ ì´ìš©í•˜ì—¬ ì´ë¯¸ì§€ ìƒì„± (ë¹Œë“œ) -> ì´ë¯¸ì§€ ìƒì„± í›„ Docker Hubì— ì „ë‹¬

-   Docker Hub

    -   Travis CIì—ì„œ ë¹Œë“œëœ ì´ë¯¸ì§€ ë³´ê´€ -> AWS Elastic BeanStalkì—ì„œ ê°€ì ¸ê°€ë ¤ í•  ë•Œ ì „ë‹¬

-    AWS Elastic BeanStalk

     -    Elastic BeanStalkë¥¼ í†µí•´ ë°°í¬


ğŸ“š ì§€ê¸ˆê¹Œì§€ ê³¼ì • ì •ë¦¬

-   8ê°•ì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ì „ì²´ ì†ŒìŠ¤ ì½”ë“œë¥¼ ì‘ì„±í•˜ê³  ê°ê°ì— ë§ëŠ” Dockerfileì„ ì‘ì„±í–ˆìœ¼ë©° ê·¸ ê°ê°ì˜ ì»¨í…Œì´ë„ˆë“¤ì„ ì—°ê²° ì‹œì¼œì£¼ê³  ê°„ë‹¨í•˜ê²Œ í•œë²ˆì— ì‹¤í–‰ ì‹œí‚¬ ìˆ˜ ìˆëŠ” Docker Composeë¥¼ ì‘ì„±í–ˆë‹¤.

-   ì´ë²ˆ 9ê°•ì—ì„œëŠ” ì†ŒìŠ¤ì½”ë“œê°€ ì—ëŸ¬ê°€ ì—†ëŠ”ì§€ í…ŒìŠ¤íŠ¸ë¥¼ í•œ í›„ í…ŒìŠ¤íŠ¸ì—ì„œ ì„±ê³µì„ í•˜ë©´ AWSë¥¼ í†µí•´ì„œ ë°°í¬ë¥¼ í•˜ëŠ” ê²ƒê¹Œì§€ í•´ë³´ì

-   í•˜ì§€ë§Œ ë°ì´í„° ë² ì´ìŠ¤ë¥¼ ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë„ì»¤ë¥¼ ì´ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆê¸°ì— AWS RDSë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.
ê·¸ë ‡ê¸°ì— MYSQL ë¶€ë¶„ì„ ë¨¼ì € ì •ë¦¬í•´ë³´ì.


### Docker í™˜ê²½ì— MYSQL ë¶€ë¶„ ì •ë¦¬í•˜ê¸°


-   Mysqlì´ ì´ì œëŠ” ë„ì»¤ ì•ˆì—ì„œ ëŒì•„ê°€ëŠ”ê²Œ ì•„ë‹Œ AWSì—ì„œ ëŒì•„ê°€ê³  ìˆëŠ” ê²ƒì„ ìš°ë¦¬ì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì—°ê²°ë§Œ í•´ì¤„ ê²ƒì´ë‹ˆ Mysqlì„ ì–´í”Œë¦¬ì¼€ì´ì…˜ì— ì—°ê²°í•´ì£¼ëŠ” ë¶€ë¶„ì„ ë¹¼ê³  ë‹¤ ì§€ì›Œì¤€ë‹¤.

=> docker-compose.yml íŒŒì¼ì—ì„œ mysql ë¶€ë¶„ì„ ì§€ìš´ë‹¤.

### Travis CI Steps

-   ê¹ƒí—™ì— Master ë¸Œëœì¹˜ì— ìƒˆë¡œ ì—…ë°ì´íŠ¸ëœ ì†ŒìŠ¤ê°€ ì˜¬ë¼ì™”ë‹¤ë©´ ì´ì œëŠ” ê·¸ ì†ŒìŠ¤ë¥¼ Travis CIì—ì„œ ê°€ì ¸ì™€ì¤˜ì•¼ í•œë‹¤.

ğŸ“Œ Travis CI í• ê²ƒë“¤ steps

ê¹ƒí—™ì— ì½”ë“œë¥¼ push -> Travis CIê°€ ìë™ìœ¼ë¡œ ì½”ë“œë¥¼ ê°€ì ¸ì˜´ -> ê°€ì ¸ì˜¨ ì½”ë“œë¡œ ``í…ŒìŠ¤íŠ¸`` ì½”ë“œë¥¼ ì§„í–‰ -> ì„±ê³µí•˜ë©´ ìš´ì˜í™˜ê²½ ``ì´ë¯¸ì§€`` ë“¤ì„ ``Build`` í•œë‹¤ -> ë¹Œë“œëœ ì´ë¯¸ì§€ë“¤ì„ ``Docker Hub``ë¡œ ë³´ë‚¸ë‹¤ -> AWS EBì— Docker Hubì— ì´ë¯¸ì§€ë¥¼ ë³´ëƒˆë‹¤ê³  ì•Œë¦¼ -> AWS EBì—ì„œ Docker Hubì— ìˆëŠ” ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì˜¨ í›„ ë°°í¬í•œë‹¤.

-   ë¹Œë“œëœ ì´ë¯¸ì§€ë“¤ì„ ``Docker Hub``ë¡œ ë³´ë‚¸ë‹¤

    -   Docker Hubì— ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë³´ë‚´ê³  AWSì—ì„œ ê·¸ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ê°ìœ¼ë¡œì¨, EBì•ˆì—ì„œ ë‹¤ì‹œ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ì§€ ì•Šì•„ë„ ëœë‹¤ ! ( ëª¨ë“  ê³¼ì • ì¤‘ì— í•œë²ˆì˜ ë¹Œë“œë§Œ ì´ë¤„ì§)

    -   docker hubì—ì„œëŠ” ìœ ëª…í•œ ì´ë¯¸ì§€ë¥¼ ë‹¤ìš´ë°›ì„ ìˆ˜ ìˆì„ ë¿ë§Œ ì•„ë‹ˆë¼, ìì‹ ì´ ë§Œë“  ì´ë¯¸ì§€ë„ ì—…ë¡œë“œ í•  ìˆ˜ ìˆë‹¤.


### .travis.yml íŒŒì¼ ì‘ì„±í•˜ê¸°

`íŒŒì¼ ìƒì„± -> Testë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì¤€ë¹„ -> Testë¥¼ ìˆ˜í–‰í•˜ê¸° ->  ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ìš´ì˜ë²„ì „ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê¸° -> ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ë³´ë‚´ì£¼ê¸° -> ë°°í¬í•˜ê¸°`

-   íŒŒì¼ ìƒì„±   

    -   .travis.yml

-   Testë¥¼ ìˆ˜í–‰í•˜ê¸° ìœ„í•œ ì¤€ë¹„

    -   ì•±ì„ ë„ì»¤ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ê³  ìˆìœ¼ë‹ˆ Travis CIì—ê²Œ ë„ì»¤í™˜ê²½ìœ¼ë¡œ ë§Œë“¤ ê²ƒì´ë¼ê³  ì„ ì–¸ í•´ì£¼ê¸° -> êµ¬ì„±ëœ ë„ì»¤ í™˜ê²½ì—ì„œ Dockerfile.devë¥¼ ì´ìš©í•´ì„œ ë„ì»¤ ì´ë¯¸ì§€ ìƒì„±

-   Testë¥¼ ìˆ˜í–‰í•˜ê¸°

    -   ìƒì„±ëœ í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ë¥¼ ì´ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ ìˆ˜í–‰í•˜ê¸°

-   ëª¨ë“  í”„ë¡œì íŠ¸ì˜ ìš´ì˜ë²„ì „ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ê¸°

    -   í…ŒìŠ¤íŠ¸ê°€ ì„±ê³µí–ˆë‹¤ë©´ í•˜ë‚˜í•˜ë‚˜ì˜ í”„ë¡œì íŠ¸ì˜ ìš´ì˜ë²„ì „ ì´ë¯¸ì§€ë¥¼ ë¹Œë“œí•˜ëŠ”  ì„¤ì •ì„ í•´ì£¼ê¸°.

- ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ë³´ë‚´ì£¼ê¸°

    -   ë„ì»¤ í—ˆë¸Œì— ë¹Œë“œëœ íŒŒì¼ì„ ë„£ì–´ì£¼ê¸° ìœ„í•´ ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸ -> ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œì— ë³´ë‚´ì£¼ê¸°

-   ë°°í¬í•˜ê¸°

    -   AWS Elastic BeanStalkì´ ì—…ë°ì´íŠ¸ëœ ë¹Œë“œ ì´ë¯¸ì§€ë¥¼ ê°€ì ¸ì™€ì„œ ë°°í¬ í•  ìˆ˜ ìˆê²Œ ì„¤ì • í•´ì£¼ê¸°

âœ” .travis.yml

```js
language: generic

sudo: required

services:
  - docker

# before_install:
#   - docker build -t magicnc7/react-test-app -f ./frontend/Dockerfile.dev ./frontend

# script:
#   - docker run -e CI=true magicnc7/react-test-app npm run test

after_success:
  - docker build -t magicnc7/docker-frontend ./frontend
  - docker build -t magicnc7/docker-backend ./backend
  - docker build -t magicnc7/docker-nginx ./nginx

  - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin (ë„ì»¤ í—ˆë¸Œì— ë¡œê·¸ì¸, .travis.yml íŒŒì¼ì— ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë„£ìœ¼ë©´ ë…¸ì¶œ ìœ„í—˜ì´ ìˆê¸°ì— ë„ì»¤ í—ˆë¸Œ ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ Travis CI í™ˆí˜ì´ì§€ì— ë¯¸ë¦¬ ë„£ì–´ì¤˜ì•¼ í•œë‹¤.)

  - docker push magicnc7/docker-frontend (ë„ì»¤ í—ˆë¸Œì— push)
  - docker push magicnc7/docker-backend
  - docker push magicnc7/docker-nginx
```


### Dockerrun.aws.jsonì— ëŒ€í•˜ì—¬

-   6, 7ê°•ì—ì„œ ë¦¬ì•¡íŠ¸ë§Œì„ ì´ìš©í•´ì„œ ì•±ì„ ë§Œë“¤ ë•ŒëŠ” Dockerrun.aws.jsonì´ë¼ëŠ” íŒŒì¼ì„ ì‚¬ìš©í•˜ì§€ ì•Šì•˜ì—ˆëŠ”ë° ì´ë²ˆì—ëŠ” ì´ íŒŒì¼ì„ ì¨ì•¼ì§€ Elastic Beanstalkì—ì„œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ì‘ë™ ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

-   ì´ë²ˆì—ëŠ” ë…¸ë“œ, Mysql, Nginx ë“±ì„ ìœ„í•œ Dockerfileì´ ì—¬ëŸ¿ ìˆë‹¤. ê·¸ëŸ¬ê¸°ì— EBê°€ ì–´ë–¤ íŒŒì¼ì„ ë¨¼ì € ì‹¤í–‰í•˜ê³  ì–´ë–»ê²Œ í–‰ë™ì„ ì·¨í•´ì•¼ í•˜ëŠ”ì§€ ìë™ìœ¼ë¡œ í”„ë¡œì„¸ìŠ¤ë¥¼ í•´ ë‚˜ê°ˆ ìˆ˜ ì—†ê¸° ë•Œë¬¸ì— ì„ì˜ë¡œ ì„¤ì •ì„ í•´ì£¼ì–´ì•¼ í•œë‹¤. ê·¸ê±¸ ì„¤ì •í•´ì£¼ëŠ” íŒŒì¼ì´ `Dockerrun.aws.json` íŒŒì¼ì´ë‹¤

âœ¨ AWSì—ì„œ ë§í•˜ëŠ” Dockerrun.aws.json íŒŒì¼ì˜ ì •ì˜

-   `Dockerrun.aws.json` íŒŒì¼ì€ Docker ì»¨í…Œì´ë„ˆ ì„¸íŠ¸ë¥¼ Elastic Beanstalk ì• í”Œë¦¬ì¼€ì´ì…˜ìœ¼ë¡œ ë°°í¬í•˜ëŠ” ë°©ë²•ì„ ì„¤ëª…í•˜ëŠ” Elastic BeanStalk ê³ ìœ ì˜ JSON íŒŒì¼ì´ë‹¤. `Dockerrun.aws.json` íŒŒì¼ì„ ë©€í‹°ì»¨í…Œì´ë„ˆ ë„ì»¤ í™˜ê²½ì— ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤

-    `Dockerrun.aws.json`ì€ í™˜ê²½ì—ì„œ ê° ì»¨í…Œì´ë„ˆ ì¸ìŠ¤í„´ìŠ¤ (Docker ì»¨í…Œì´ë„ˆë¥¼ í˜¸ìŠ¤íŠ¸í•˜ëŠ” Amazon EC2 ì¸ìŠ¤í„´ìŠ¤)ì— ë°°í¬í•  ì»¨í…Œì´ë„ˆ ë° íƒ‘ì¬í•  ì»¨í…Œì´ë„ˆì˜ í˜¸ìŠ¤íŠ¸ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ìƒì„±í•  ë°ì´í„° ë³¼ë¥¨ì„ ì„¤ëª…í•œë‹¤

- ê°„ë‹¨í•˜ê²Œ ì–´ë–»ê²Œ ë‹¤ì¤‘ ì»¨í…Œì´ë„ˆë¥¼ ì‘ë™ì‹œí‚¬ ì§€ ì•Œë ¤ì¤€ë‹¤.

### Dockerrun.aws.json ì‘ì„±í•˜ê¸°

`Dockerrun.aws.json íŒŒì¼ ìƒì„± -> Container Definitionsì„ ì‘ì„±í•˜ê¸°`


âœ” Dockerrun.aws.json

```js
{
    "AWSEBDockerrunVersion": 2,
    "containerDefinitions": [
        {
            "name": "frontend",
            "image": "smileajw1004/docker-frontend",
            "hostname": "frontend",
            "essential": false,
            "memory": 128
        },
        {
            "name": "backend",
            "image": "smileajw1004/docker-backend",
            "hostname": "backend",
            "essential": false,
            "memory": 128
        },
        {
            "name": "nginx",
            "image": "smileajw1004/docker-nginx",
            "hostname": "nginx",
            "essential": true,
            "portMappings": [
                {
                    "hostPort": 80,
                    "containerPort": 80
                }
            ],
            "links": ["frontend", "backend"],
            "memory": 128
        }
    ]
}
```

-   AWSEBDockerrunVersion

    -   Dockerrun ë²„ì „ 2ë¡œ ì§€ì •

-   containerDefinitions

    - ì´ ì•ˆì—ì„œ ì»¨í…Œì´ë„ˆë“¤ì„ ì •ì˜í•´ì¤€ë‹¤.

-   name

    -   ì»¨í…Œì´ë„ˆì˜ ì´ë¦„

-   image

    -   Docker ì»¨í…Œì´ë„ˆë¥¼ êµ¬ì¶•í•  ì˜¨ë¼ì¸ Docker ë ˆí¬ì§€í† ë¦¬ì˜ Docker ì´ë¯¸ì§€ ì´ë¦„

-   hostname

    -   í˜¸ìŠ¤íŠ¸ ì´ë¦„

    -   ì´ ì´ë¦„ì„ ì´ìš©í•´ ë„ì»¤ ì»´í¬ì¦ˆë¥¼ ì´ìš©í•´ ìƒì„±ëœ ë‹¤ë¥¸ ì»¨í…Œì´ë„ˆì—ì„œ ì ‘ê·¼ì´ ê°€ëŠ¥

-   essential

    -   ì»¨í…Œì´ë„ˆê°€ ì‹¤íŒ¨í•  ê²½ìš° ì‘ì—…ì„ ì¤‘ì§€í•´ì•¼ í•˜ë©´ true ì´ë‹¤

    -   í•„ìˆ˜ì ì´ì§€ ì•Šì€ ì»¨í…Œì´ë„ˆëŠ” ì¸ìŠ¤í„´ìŠ¤ì˜ ë‚˜ë¨¸ì§€ ì»¨í…Œì´ë„ˆì— ì˜í–¥ì„ ë¯¸ì¹˜ì§€ ì•Šê³  ì¢…ë£Œë˜ê±°ë‚˜ ì¶©ëŒí•  ìˆ˜ ìˆë‹¤
