### 섹션 설명

✔ 구현순서 (8강)

`소스 코드 작성 -> Dockerfile 작성 -> docker-compose 작성`

-   소스 코드 작성

    -   NodeJs -> React

-   Dockerfile 작성

    -   개발환경
        
        - Front -> Server -> mysql -> nginx

    -   운영환경

        -   Front -> Server -> Mysql -> Nginx

-   docker-compose 작성

    ``` js
    version

    services

        frontend

        backend

        nginx

        mysql
    ```

✔ 구현순서 (9강)

` 깃헙에 Push -> Travis CI -> Docker Hub -> AWS ElasticBeanStalk
`

-   깃헙에 Push

    -   Feature branch -> Master branch

-    Travis CI


        -   테스트 소스 실행 -> 테스트 성공 -> 각각의 Dockerfile을 이용하여 이미지 생성 (빌드) -> 이미지 생성 후 Docker Hub에 전달

-   Docker Hub

    -   Travis CI에서 빌드된 이미지 보관 -> AWS Elastic BeanStalk에서 가져가려 할 때 전달

-    AWS Elastic BeanStalk

     -    Elastic BeanStalk를 통해 배포


📚 지금까지 과정 정리

-   8강에서 어플리케이션을 위한 전체 소스 코드를 작성하고 각각에 맞는 Dockerfile을 작성했으며 그 각각의 컨테이너들을 연결 시켜주고 간단하게 한번에 실행 시킬 수 있는 Docker Compose를 작성했다.

-   이번 9강에서는 소스코드가 에러가 없는지 테스트를 한 후 테스트에서 성공을 하면 AWS를 통해서 배포를 하는 것까지 해보자

-   하지만 데이터 베이스를 운영 환경에서는 도커를 이용하는 것이 아니기에 AWS RDS를 이용해야 한다.
그렇기에 MYSQL 부분을 먼저 정리해보자.


### Docker 환경에 MYSQL 부분 정리하기


-   Mysql이 이제는 도커 안에서 돌아가는게 아닌 AWS에서 돌아가고 있는 것을 우리의 어플리케이션에 연결만 해줄 것이니 Mysql을 어플리케이션에 연결해주는 부분을 빼고 다 지워준다.

=> docker-compose.yml 파일에서 mysql 부분을 지운다.

### Travis CI Steps

-   깃헙에 Master 브랜치에 새로 업데이트된 소스가 올라왔다면 이제는 그 소스를 Travis CI에서 가져와줘야 한다.

📌 Travis CI 할것들 steps

깃헙에 코드를 push -> Travis CI가 자동으로 코드를 가져옴 -> 가져온 코드로 ``테스트`` 코드를 진행 -> 성공하면 운영환경 ``이미지`` 들을 ``Build`` 한다 -> 빌드된 이미지들을 ``Docker Hub``로 보낸다 -> AWS EB에 Docker Hub에 이미지를 보냈다고 알림 -> AWS EB에서 Docker Hub에 있는 이미지를 가져온 후 배포한다.

-   빌드된 이미지들을 ``Docker Hub``로 보낸다

    -   Docker Hub에 빌드된 이미지를 보내고 AWS에서 그 이미지를 가져감으로써, EB안에서 다시 이미지를 빌드하지 않아도 된다 ! ( 모든 과정 중에 한번의 빌드만 이뤄짐)

    -   docker hub에서는 유명한 이미지를 다운받을 수 있을 뿐만 아니라, 자신이 만든 이미지도 업로드 할 수 있다.


### .travis.yml 파일 작성하기

`파일 생성 -> Test를 수행하기 위한 준비 -> Test를 수행하기 ->  모든 프로젝트의 운영버전 이미지를 빌드하기 -> 빌드된 이미지를 도커 허브에 보내주기 -> 배포하기`

-   파일 생성   

    -   .travis.yml

-   Test를 수행하기 위한 준비

    -   앱을 도커 환경에서 실행하고 있으니 Travis CI에게 도커환경으로 만들 것이라고 선언 해주기 -> 구성된 도커 환경에서 Dockerfile.dev를 이용해서 도커 이미지 생성

-   Test를 수행하기

    -   생성된 테스트 이미지를 이용해서 테스트 수행하기

-   모든 프로젝트의 운영버전 이미지를 빌드하기

    -   테스트가 성공했다면 하나하나의 프로젝트의 운영버전 이미지를 빌드하는  설정을 해주기.

- 빌드된 이미지를 도커 허브에 보내주기

    -   도커 허브에 빌드된 파일을 넣어주기 위해 도커 허브에 로그인 -> 빌드된 이미지를 도커 허브에 보내주기

-   배포하기

    -   AWS Elastic BeanStalk이 업데이트된 빌드 이미지를 가져와서 배포 할 수 있게 설정 해주기

✔ .travis.yml

```js
language: generic

sudo: required

services:
  - docker

# before_install:
#   - docker build -t magicnc7/react-test-app -f ./frontend/Dockerfile.dev ./frontend

# script:
#   - docker run -e CI=true magicnc7/react-test-app npm run test

after_success:
  - docker build -t magicnc7/docker-frontend ./frontend
  - docker build -t magicnc7/docker-backend ./backend
  - docker build -t magicnc7/docker-nginx ./nginx

  - echo "$DOCKER_HUB_PASSWORD" | docker login -u "$DOCKER_HUB_ID" --password-stdin (도커 허브에 로그인, .travis.yml 파일에 아이디와 비밀번호를 넣으면 노출 위험이 있기에 도커 허브 아이디와 비밀번호를 Travis CI 홈페이지에 미리 넣어줘야 한다.)

  - docker push magicnc7/docker-frontend (도커 허브에 push)
  - docker push magicnc7/docker-backend
  - docker push magicnc7/docker-nginx
```

