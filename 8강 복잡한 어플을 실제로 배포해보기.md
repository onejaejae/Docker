### ì„¹ì…˜ ì„¤ëª…

-   6, 7ê°• ì„¹ì…˜ì—ì„œ ë„ì»¤ë¥¼ ì´ìš©í•˜ì—¬ ë¦¬ì•¡íŠ¸ ì•±ì„ ë§Œë“¤ì–´ë´¤ë‹¤.

-   í•˜ì§€ë§Œ ì‹¤ì œë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ë•ŒëŠ” í”„ë¡ íŠ¸ ë¶€ë¶„ë§Œì„ ì´ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ ë°±ì—”ë“œ ì„œë²„ë„ í•„ìš”í•˜ê³  ë°ì´í„°ë² ì´ìŠ¤ ë“± ë§ì€ ê²ƒì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì— ì´ë²ˆ ì„¹ì…˜ë¶€í„°ëŠ” ì¢€ ë” ë§ì€ ì»¨í…Œì´ë„ˆë¥¼ ì‚¬ìš©í•´ì„œ ì¢€ ë” ì‹¤ë¬´ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ì–´ë³´ì.

ğŸ“ ì—¬ëŸ¬ê°œì˜ ì»¨í…Œì´ë„ˆë¥¼ ì´ìš©í•´ êµ¬í˜„í•  ì–´í”Œë¦¬ì¼€ì´ì…˜ì€?

-   í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì•„ë¬´ê¸€ì´ë‚˜ ì…ë ¥ì„ í•˜ë©´ ë¦¬ì•¡íŠ¸ë¥¼ í†µí•´ì„œ ë…¸ë“œë¡œ ì „ë‹¬ ëœ ì´í›„ Mysql ë°ì´í„° ë² ì´ìŠ¤ì— ì €ì¥í•œ í›„ ì €ì¥ ëœ ê²ƒì„ í™”ë©´ì— ë³´ì—¬ì£¼ëŠ” ì•±ì„ êµ¬í˜„í•  ê²ƒì´ë‹¤.

-   ê·¸ë¦¬ê³  ì»¨í…Œì´ë„ˆë¥¼ ì‚­ì œ í–ˆë‹¤ê°€ ë‹¤ì‹œ ìƒì„±í•´ë„ DBì— ì €ì¥ëœ ë°ì´í„°ëŠ” ë‚¨ì•„ìˆê²Œ í•´ì¤„ ê²ƒì´ë‹¤.

ğŸ“Œ Multi Container ì•±ì„ ìœ„í•œ ì „ì²´ì ì¸ ì„¤ê³„

-   ë‘ê°€ì§€ ë°©ë²•

1.    Nginxë¡œ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì˜¤ëŠ” ìš”ì²­ì„ ë°±ì—”ë“œ ì„œë²„ì™€ í”„ë¡ íŠ¸ ì„œë²„ë¡œ ë‚˜ëˆ ì£¼ëŠ” êµ¬ì¡°.
   
              
    âœ” ì¥ì 

    -  ìš”ì²­ì„ ë³´ë‚¼ ë•Œ URL ë¶€ë¶„ì„ hostì´ë¦„ì´ ë°”ë€Œì–´ë„ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤

    -   í¬íŠ¸ê°€ ë°”ë€Œì–´ë„ ë³€ê²½í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

    ex) axios.get("api/valuse")

    âœ” ë‹¨ì 

    -  nginx ì„¤ì •, ì „ì²´ ì„¤ê³„ê°€ ë³µì¡í•˜ë‹¤


2.   NginxëŠ” í”„ë¡ íŠ¸ ì„œë²„ë¡œë§Œ ì‚¬ìš©í•˜ì—¬ í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì •ì  íŒŒì¼ì„ ìš”êµ¬í•  ë•Œ ì œê³µí•´ì£¼ëŠ” í˜•ì‹ìœ¼ë¡œë§Œ ì“°ì´ëŠ” êµ¬ì¡°

    âœ” ì¥ì 

     -  ì„¤ê³„ê°€ ë‹¤ì†Œ ê°„ë‹¨í•˜ì—¬ êµ¬í˜„í•˜ëŠ”ê²Œ ë” ì‰½ë‹¤

    ex) axios.get("http://localhost:3000/api/valuse")

    âœ” ë‹¨ì 

     -  hostì´ë¦„ì´ë‚˜ í¬íŠ¸ ë³€ê²½ì´ ìˆìœ¼ë©´ ìš”ì²­ URLë„ ë³€ê²½í•´ì•¼ í•œë‹¤.

-   ë³µì¡í•œ ìª½ìœ¼ë¡œ êµ¬í˜„ì„ ì‹œì‘í•´ë³´ì!

ğŸ‘€ ì „ì²´ì ì¸ íë¦„

  `ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ ì‘ì„± => Dockerfile ì‘ì„± => docker-compose ì‘ì„±` (8ê°•)


-   ì „ì²´ ì†ŒìŠ¤ ì½”ë“œ ì‘ì„±

        -  NodeJs => React

-   Dockerfile ì‘ì„±

    -   ê°œë°œí™˜ê²½(Dockerfile.dev)
        
        -   Front => Server  => Mysql => Nginx 

    -   ìš´ì˜í™˜ê²½(Dockerfile)

        -   Front => Server  => Mysql => Nginx 

-   docker-compose ì‘ì„±

```js
version

services
    
    frontend

    backend

    nginx

    mysql

```
`ê¹ƒí—™ì— Push => Travis CI => Docker Hub => AWS ElasticBeanStalk` (9ê°•)

-   ê¹ƒí—™ì— Push
    
    - Feature Branch => Master Branch

-   Travis CI

    -   í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‹¤í–‰ => í…ŒìŠ¤íŠ¸ ì„±ê³µ => ê°ê°ì˜ Dockerfileì„ ì´ìš©í•˜ì—¬ Imageë¥¼ ìƒì„±(ë¹Œë“œ) => ì´ë¯¸ì§€ ìƒì„± í›„ Docker Hubë¡œ ì „ë‹¬

-   Docker Hub

    -  Travis CIì—ì„œ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ë³´ê´€

    -   AWS ElasticBeanStalkì—ì„œ ê°€ì ¸ê°€ë ¤ê³  í•  ë•Œ ì „ë‹¬

-   AWS ElasticBeanStalk

    -   Travis CIì—ì„œ ë¹Œë“œëœ ì´ë¯¸ì§€ë¥¼ ì´ìš©í•´ì„œ ë°°í¬

### ë¦¬ì•¡íŠ¸ ì•±ì„ ìœ„í•œ ë„ì»¤ íŒŒì¼ ë§Œë“¤ê¸°

-   ì‘ì„±í•œ ì†ŒìŠ¤ì½”ë“œë¥¼ ë„ì»¤ í™˜ê²½ì—ì„œ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” Dockerfileì„ ì‘ì„±í•´ë³´ì.

-   Dockerfileì€ ê°œë°œí™˜ê²½ê³¼ ìš´ì˜í™˜ê²½ì—ì„œ ë‹¤ë¥´ê²Œ êµ¬ì„±í•˜ëŠ” ê²ƒì´ ì¢‹ê¸° ë•Œë¬¸ì— ê°œë°œí™˜ê²½ì„ ìœ„í•œ Dockerfileì„ ë§Œë“¤ê³  ê·¸ í›„ì— ìš´ì˜í™˜ê²½ì„ ìœ„í•œ Dockerfileì„ ë§Œë“¤ì.

âœ” Dockerfile.dev

```js
FROM node:alpine

WORKDIR /app

COPY package.json ./

RUN npm install

COPY ./ ./

CMD ["npm", "run", "start"]
```

âœ” Dockerfile

```js
FROM node:alpine as builder

WORKDIR /app

COPY package.json ./

RUN npm install

COPY ./ ./

RUN npm run build

FROM nginx

EXPOSE 3000

COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf

COPY --from=builder /app/build /usr/share/nginx/html
```
ğŸ“Œ `COPY ./nginx/default.conf /etc/nginx/conf.d/default.conf`

-   default.confì—ì„œ í•´ì¤€ ì„¤ì •ì„ nginx ì„¤ì •ì•ˆì— ìˆëŠ” ì„¤ì •ì´ ë˜ê²Œ ë³µì‚¬í•´ì¤€ë‹¤

âœ” default.conf

```js
server {
    listen 3000;

    location / {
        root /usr/share/nginx/html;

        index index.html index.htm;

        try_files $uri $uri/ /index.html;
    }
}
```

-    listen 3000 : nginx ì„œë²„ê°€

-    root /usr/share/nginx/html; : HTML íŒŒì¼ì´ ìœ„ì¹˜í•  ë£¨íŠ¸ ì„¤ì •

-    index index.html index.htm; : ì‚¬ì´íŠ¸ì˜ index í˜ì´ì§€ë¡œ í•  íŒŒì¼ëª… ì„¤ì •

-   try_files $uri $uri/ /index.html; 

    -   React Routerë¥¼ ì‚¬ìš©í•´ì„œ í˜ì´ì§€ê°„ ì´ë™ì„ í•  ë•Œ ì´ë¶€ë¶„ì´ í•„ìš”í•˜ë‹¤ 

    -   ì¢€ ë” ìì„¸í•œ ì„¤ëª…
        
        - ReactëŠ” SPAì´ë‹¤. ê·¸ëŸ¬ê¸°ì—  index.html í•˜ë‚˜ì˜ ì •ì  íŒŒì¼ë§Œ ê°€ì§€ê³  ìˆì–´ì„œ ë§Œì•½ {URL}/home ì´ë ‡ê²Œ ì ‘ì†ì„ í•˜ë ¤ê³  í• ë•Œë„ index.html íŒŒì¼ì— ì ‘ê·¼ì„ í•´ì„œ ë¼ìš°íŒ…ì„ ì‹œì¼œì•¼ í•˜ëŠ”ë° nginxì—ì„œëŠ” ìë™ìœ¼ë¡œ ì´ê²ƒì„ ì•Œ ìˆ˜ ì—†ë‹¤. ê·¸ëŸ¬ê¸°ì— /homeì— ì ‘ì†í•˜ë ¤ê³  í•  ë•Œ /homeì— ë§¤ì¹­ë˜ëŠ” ê²ƒì´ ì—†ì„ ë–„ì— ëŒ€ì•ˆì±…ìœ¼ë¡œ index.htmlì„ ì œê³µí•˜ì—¬ì„œ /homeìœ¼ë¡œ ë¼ìš°íŒ…ì„ ì‹œí‚¬ ìˆ˜ ìˆê²Œ ì„¤ì •ì„ í•´ì£¼ëŠ” ê²ƒì´ë‹¤.    

### ë…¸ë“œ ì•±ì„ ìœ„í•œ ë„ì»¤ íŒŒì¼ ë§Œë“¤ê¸°

âœ” Dockerfile.dev

```js
FROM node:alpine

WORKDIR /app

COPY ./package.json ./

RUN npm install

COPY ./ ./

CMD ["npm", "run", "dev"]
```

âœ” Dockerfile

```js
FROM node:alpine

WORKDIR /app

COPY ./package.json ./

RUN npm install

COPY ./ ./

CMD ["npm", "run", "start"]
```

ğŸ“Œ CMD ["npm", "run", "start"] => ìš´ì˜í™˜ê²½ì—ì„œëŠ” ì†ŒìŠ¤ê°€ ë³€ê²½ë  ë•Œë§ˆë‹¤ ë°”ë¡œ ë°˜ì˜ì‹œì¼œ ì¤„ í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸

### DBì— ê´€í•´ì„œ

-   ê°œë°œí™˜ê²½ê³¼ ìš´ì˜í™˜ê²½ì—ì„œ DB êµ¬ì„±ì„ ì–´ë–»ê²Œ í•  ì§€ ì•Œì•„ë³´ì.

âœ” ê°œë°œ í™˜ê²½

-   ë„ì»¤ í™˜ê²½ ì´ìš©

âœ” ìš´ì˜ í™˜ê²½

-   AWS RDS ì„œë¹„ìŠ¤ ì´ìš©

ğŸ¤·â€â™€ï¸ ì´ë ‡ê²Œ ë‚˜ëˆ„ëŠ” ì´ìœ ëŠ”?

-   DB ì‘ì—…ì€ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ë³´ê´€í•˜ê³  ì´ìš©í•˜ëŠ” ë¶€ë¶„ì´ê¸°ì— ì¡°ê¸ˆì˜ ì‹¤ìˆ˜ë¡œë„ ì•ˆì¢‹ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤. ê·¸ëŸ¬ê¸°ì— ì‹¤ì œ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ë‹¤ë£¨ëŠ” ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ë”ìš± ì•ˆì •ì ì¸ AWS RDSë¥¼ ì´ìš©í•˜ì—¬ DBë¥¼ êµ¬ì„±í•´ë³´ëŠ” ê²ƒì´ ì‹¤ì œë¡œ ì‹¤ë¬´ì—ì„œ ë” ë³´í¸ì ìœ¼ë¡œ ì“°ì´ëŠ” ë°©ë²•ì´ê¸°ì— ì´ë ‡ê²Œ ê°œë°œí™˜ê²½ê³¼ ìš´ì˜í™˜ê²½ì„ ë‘ ë°©ë²•ìœ¼ë¡œ ë‚˜ëˆ ì„œ ì§„í–‰í•œë‹¤.

### MYSQLì„ ìœ„í•œ ë„ì»¤ íŒŒì¼ ë§Œë“¤ê¸°

âœ” Dockerfile

```js
FROM mysql:5.7
```

ğŸ“Œ í˜„ì¬ ìƒíƒœì—ì„œ ì–´ë– í•œ ê¸€ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë„£ì–´ì¤„ ë•Œ í•œê¸€ì´ ê¹¨ì§€ê²Œ ë˜ì–´ì„œ ì €ì¥ì„ í•  ë•Œ ì˜¤ë¥˜ê°€ ë‚œë‹¤. ê·¸ë˜ì„œ í•œê¸€ë„ ì €ì¥í•  ìˆ˜ ìˆê²Œ ì„¤ì •ì„ í•´ì¤˜ì•¼í•œë‹¤.

âœ” my.cnf

```js
[mysqld]
character-set-server=utf8

[mysql]
default-character-set=utf8

[client]
default-character-set=utf8
```


âœ” Dockerfileì— my.cnf ë®ì–´ì”Œìš°ê¸°

```js
FROM mysql:5.7

ADD ./my.cnf  /etc/mysql/conf.d/my.cnf
```

âœ” Dockerfileê³¼ Dockerfile.devê°€ íŠ¹ë³„íˆ ë‹¤ë¥´ê²Œ í•´ ì¤„ í•„ìš”ê°€ ì—†ë‹¤ë©´ ê°™ì€ ë‚´ìš©ì´ ë“¤ì–´ê°.

### Nginxë¥¼ ìœ„í•œ ë„ì»¤ íŒŒì¼ ë§Œë“¤ê¸°

-   í˜„ì¬ Nginxê°€ ì“°ì´ëŠ” ê³³ì€ ë‘êµ°ë°ì´ë©° ì„œë¡œ ë‹¤ë¥¸ ì´ìœ ë¡œ ì“°ì´ê³  ìˆë‹¤.

-   í•˜ë‚˜ëŠ” `Proxy`ë¥¼ ì´ìœ ë¡œ ë‹¤ë¥¸ í•˜ë‚˜ëŠ”  `Static íŒŒì¼ì„ ì œê³µ`í•´ì£¼ëŠ” ì—­í• ì„ í•˜ê³  ìˆë‹¤. 

-   ìš°ì„  ì–´ë–¤ì‹ìœ¼ë¡œ Nginxê°€ í”„ë¡ì‹œ ê¸°ëŠ¥ì„ í•´ì£¼ëŠ”ì§€ ì•Œì•„ë³´ì

-   í´ë¼ì´ì–¸íŠ¸ì— ìš”ì²­ì„ ë³´ë‚¼ ë•Œ ì •ì  íŒŒì¼ì„ ì›í• ë•ŒëŠ” Nginxì˜ ì„¤ì •ì— ë”°ë¼ ìë™ì ìœ¼ë¡œ React Jsë¡œ ë³´ë‚´ì£¼ë©°, API ìš”ì²­ì¼ ê²½ìš°ì—ëŠ” Node Jsë¡œ ë³´ë‚´ì¤€ë‹¤.

-   Nginxê°€ ìš”ì²­ì„ ë‚˜ëˆ ì„œ ë³´ë‚´ì£¼ëŠ” ê¸°ì¤€ì€ locationì´ /ë¡œ ì‹œì‘í•˜ëŠ”ì§€, /apië¡œ ì‹œì‘í•˜ëŠ”ì§€ì— ë”°ë¼ì„œ ë‚˜ëˆ ì¤€ë‹¤. 

-   /ë¡œ ì‹œì‘í•˜ë©´ React Jsë¡œ /apië¡œ ì‹œì‘í•˜ë©´ Node Jsë¡œ ë³´ë‚´ì¤€ë‹¤.


### Nginxë¥¼ ìœ„í•œ ë„ì»¤ íŒŒì¼ ë§Œë“¤ê¸°



âœ” default.conf

```js
upstream frontend {
    server frontend:3000;
}

upstream backend {
    server backend:5000;
}

server {
    listen 80;

    location / {
        proxy_pass http://frontend;
    }

    location /api {
        proxy_pass http://backend;
    }

    location /sockjs-node {
        proxy_pass http://frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }

}
```
âœ” `upstream frontend {
    server frontend:3000;
 }` 
 
 -  3000ë²ˆ í¬íŠ¸ì—ì„œ í”„ë¡ íŠ¸ì—”ë“œê°€ ëŒì•„ê°€ê³  ìˆë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•´ì¤Œ.

- server frontendì—ì„œ frontendëŠ” docker-compose íŒŒì¼ì—ì„œ ì‘ì„±í•œ services ì´ë¦„ì„ ì ëŠ”ë‹¤.

âœ” `upstream backend {
    server backend:5000;
}`

-   3000ë²ˆ í¬íŠ¸ì—ì„œ ë°±ì—”ë“œ ëŒì•„ê°€ê³  ìˆë‹¤ëŠ” ê²ƒì„ ëª…ì‹œí•´ì¤Œ.

-- server backend backendëŠ” docker-compose íŒŒì¼ì—ì„œ ì‘ì„±í•œ services ì´ë¦„ì„ ì ëŠ”ë‹¤.

âœ” `listen 80;`

-   Nginx ì„œë²„ í¬íŠ¸ë¥¼ 80ë²ˆìœ¼ë¡œ ì—´ì–´ì¤€ë‹¤.

âœ”  `location / {
        proxcy_pass http://frontend;
    }`
    
-   locationì—ëŠ” ìš°ì„ ìˆœìœ„ê°€ ìˆëŠ”ë° / ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²ƒì€ ê°€ì¥ ìš°ì„ ìˆœìœ„ê°€ ë‚®ë‹¤.

-   http://frontendì—ì„œ frontendëŠ” docker-compose íŒŒì¼ì—ì„œ ì‘ì„±í•œ services ì´ë¦„ì„ ì ëŠ”ë‹¤.

-   ê·¸ë˜ì„œ ì—¬ê¸°ì„œëŠ” /apië¡œ ì‹œì‘ë˜ëŠ” ê²ƒì„ ë¨¼ì € ì°¾ê³  ê·¸ê²Œ ì—†ë‹¤ë©´ / ë¡œ ë“¤ì–´ì˜¤ëŠ” ê²ƒì„ http://frontendë¡œ ë³´ë‚´ë©´ ëœë‹¤.

âœ”  `location /api {
        proxcy_pass http://backend;
    }`

-   /apië¡œ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ http://backendë¡œ ë³´ë‚´ì¤€ë‹¤

-  http://backendì—ì„œ backend docker-compose íŒŒì¼ì—ì„œ ì‘ì„±í•œ services ì´ë¦„ì„ ì ëŠ”ë‹¤.

âœ”   ` location /sockjs-node {
        proxy_pass http://frontend;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "Upgrade";
    }`

-   ì´ ë¶€ë¶„ì´ ì—†ìœ¼ë©´ ì—ëŸ¬ê°€ ë°œìƒ(ê°œë°œ í™˜ê²½ì—ì„œë§Œ ë°œìƒ)

-   ì—ëŸ¬ ì²˜ë¦¬ë¥¼ ìœ„í•œ ë¶€ë¶„.

ğŸ“ŒNginxë¥¼ ìœ„í•œ Dockerfile ì‘ì„±

```js
FROM nginx

COPY ./default.conf /etc/nginx/conf.d/default.conf
```

### Docker Compose íŒŒì¼ ì‘ì„±í•˜ê¸°

-   ê°ê°ì˜ ì»¨í…Œì´ë„ˆë¥¼ ìœ„í•œ ë„ì»¤ íŒŒì¼ì„ ì‘ì„±í–ˆë‹¤. í•˜ì§€ë§Œ ì»¨í…Œì´ë„ˆë“¤ì„ ë‹¤ ì‘ë™ì‹œí‚¨ë‹¤ê³  í•´ë„ ì»¨í…Œì´ë„ˆ íŠ¹ì„±ìƒ ì„œë¡œ ë‚˜ëˆ ì ¸ìˆê¸° ë•Œë¬¸ì— ì•„ë¬´ëŸ° ì¡°ì¹˜ ì—†ì´ëŠ” ì„œë¡œ í†µì‹  í•  ìˆ˜ ì—†ë‹¤.

-   ê·¸ëŸ¬ë¯€ë¡œ ì»¨í…Œì´ë„ˆë“¤ì„ ì„œë¡œ ì—°ê²°ì‹œì¼œ ì£¼ê¸° ìœ„í•´ Docker Composeë¥¼ ì‘ì„±í•´ë³´ì 

âœ” docker-compose.yml

```js
version: "3"
services:
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.dev
    volumes:
      - /app/node_modules
      - ./frontend:/app
    stdin_open: true

  nginx:
    restart: always
    build: ./nginx
    ports:
      - "3000:80"

  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile.dev
    container_name: app_backend
    volumes:
      - /app/node_modules
      - ./backend:/app

  mysql:
    build: ./mysql
    restart: unless-stopped
    container_name: app_mysql
    ports:
      - "3306:3306"
    volumes:
      - ./mysql/mysql_data:/var/lib/mysql
      - ./mysql/sqls/:/docker-entrypoint-initdb.d/
    environment:
      MYSQL_ROOT_PASSWORD: 123
      MYSQL_DATABASE: myapp
```